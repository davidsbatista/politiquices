{% extends 'base.html' %}

{% block title %} Pesquisar {% endblock %}

{% block body %}

  <div class="container">

    <script>

    // var 'nomes' is already loaded in base.html which is extended

    parties = [];
    $.getJSON("static/json/parties.json", function(json_data){
        for (var i = 0, len = json_data.length; i < len; i++) {
            var party = {label: json_data[i].name, value: json_data[i].wiki_id};
            parties.push(party);
        };
    });

    /* 1. Relações entre duas personalidades: per_one */
    $(function() {
      $("#autocomplete_per_one").autocomplete({
        source: nomes,
        focus: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox
            $(this).val(ui.item.label);
        },
        select: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox and hidden field
            $(this).val(ui.item.label);
            $("#autocomplete_per_one-value").val(ui.item.value);
        }
      });
    });

    /* 1. Relações entre duas personalidades per_two */
    $(function() {
      $("#autocomplete_per_two").autocomplete({
        source: nomes,
        focus: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox
            $(this).val(ui.item.label);
        },
        select: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox and hidden field
            $(this).val(ui.item.label);
            $("#autocomplete_per_two-value").val(ui.item.value);
        }
      });
    });


    /* 2. Relações de membros de um partido para uma pessoa: party */
    $(function() {
      $("#autocomplete_three_partido").autocomplete({
        source: parties,
        focus: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox
            $(this).val(ui.item.label);
        },
        select: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox and hidden field
            $(this).val(ui.item.label);
            $("#autocomplete_three_partido_value").val(ui.item.value);
        }
      });
    });

    /* 2. Relações de membros de um partido para uma pessoa: person */
    $(function() {
      $("#autocomplete_three_pessoa").autocomplete({
        source: nomes,
        focus: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox
            $(this).val(ui.item.label);
        },
        select: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox and hidden field
            $(this).val(ui.item.label);
            $("#autocomplete_three_pessoa_value").val(ui.item.value);
        }
      });
    });


    /* 3. Relações de uma pessoa para membros de um partido: person */
    $(function() {
      $("#autocomplete_four_pessoa").autocomplete({
        source: nomes,
        focus: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox
            $(this).val(ui.item.label);
        },
        select: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox and hidden field
            $(this).val(ui.item.label);
            $("#autocomplete_four_pessoa_value").val(ui.item.value);
        }
      });
    });

    /* 3. Relações de uma pessoa para membros de um partido: party */
    $(function() {
      $("#autocomplete_four_partido").autocomplete({
        source: parties,
        focus: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox
            $(this).val(ui.item.label);
        },
        select: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox and hidden field
            $(this).val(ui.item.label);
            $("#autocomplete_four_partido_value").val(ui.item.value);
        }
      });
    });


    /* 4. Relações entre (membros de ) dois partidos: party one */
    $(function() {
      $("#autocomplete_five_party_one").autocomplete({
        source: parties,
        focus: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox
            $(this).val(ui.item.label);
        },
        select: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox and hidden field
            $(this).val(ui.item.label);
            $("#autocomplete_five_party_one_value").val(ui.item.value);
        }
      });
    });

    /* 4. Relações entre (membros de ) dois partidos: party two */
    $(function() {
      $("#autocomplete_five_party_two").autocomplete({
        source: parties,
        focus: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox
            $(this).val(ui.item.label);
        },
        select: function(event, ui) {
            // prevent autocomplete from updating the textbox
            event.preventDefault();
            // manually update the textbox and hidden field
            $(this).val(ui.item.label);
            $("#autocomplete_five_party_two_value").val(ui.item.value);
        }
      });
    });

    $(document).ready ( function () {

        $body = $("body");

        $(document).on({
          ajaxStart: function() { $body.addClass("loading"); },
          ajaxStop: function() { $body.removeClass("loading"); }
        });

        /* Relações entre duas personalidade */
        $(document).on ("click", "#btn_two", function () {
            var wiki_id_one = $('#autocomplete_per_one-value').val();
            var wiki_id_two = $('#autocomplete_per_two-value').val();
            var data = { query_nr: 'two',
                         e1: wiki_id_one,
                         e2: wiki_id_two};
            $.ajax({
              type: 'get',
              data: data,
              url: '/queries',
              error: function () {
                alert("There was an error processing this page.");
                return false;
              },
              complete: function (output) {
                $('#inner').html(output.responseText);

              }
            });
        });

        /* Relações entre (membros de) um partido e uma personalidade */
        $(document).on ("click", "#btn_three", function () {
            var party_wiki_id = $('#autocomplete_three_partido_value').val();
            var entity_wiki_id = $('#autocomplete_three_pessoa_value').val();
            var e = document.getElementById("dropdownMenuButton2");
            var data = { query_nr: 'three',
                         party: party_wiki_id,
                         entity: entity_wiki_id,
                         relationship: e.textContent
                       };
            $.ajax({
              type: 'get',
              data: data,
              url: '/queries',
              error: function () {
                alert("There was an error processing this page.");
                return false;
              },
              complete: function (output) {
                $('#inner').html(output.responseText);
              }
            });
        });

        /* Relações de uma personalidade para (membros de) um partido */
        $(document).on ("click", "#btn_four", function () {
            var entity_wiki_id = $('#autocomplete_four_pessoa_value').val();
            var party_wiki_id = $('#autocomplete_four_partido_value').val();
            var e = document.getElementById("dropdownMenuButton3");
            var data = { query_nr: 'four',
                         party: party_wiki_id,
                         entity: entity_wiki_id,
                         relationship: e.textContent
                       };
            $.ajax({
              type: 'get',
              data: data,
              url: '/queries',
              error: function () {
                alert("There was an error processing this page.");
                return false;
              },
              complete: function (output) {
                $('#inner').html(output.responseText);
              }
            });
        });

        /* Relações entre (membros de) dois partidos */
        $(document).on ("click", "#btn_five", function () {
            var party_a_wiki_id = $('#autocomplete_five_party_one_value').val();
            var party_b_wiki_id = $('#autocomplete_five_party_two_value').val();
            var e = document.getElementById("dropdownMenuButton4");
            var data = { query_nr: 'five',
                         party_a: party_a_wiki_id,
                         party_b: party_b_wiki_id,
                         relationship: e.textContent};
            $.ajax({
              type: 'get',
              data: data,
              url: '/queries',
              error: function () {
                alert("There was an error processing this page.");
                return false;
              },
              complete: function (output) {
                $('#inner').html(output.responseText);
              }
            });
        });

    });

    /* Dropdown to correct/annotataed relationships */
    $(document).ready(function() {
       $(".dropdown-menu").on('click', 'a', function(){
         $(this).parents('.dropdown').find('button').text($(this).text());
       });
    });


    </script>

    <div id="inner" class="w-100 p-1">

    <hr>

    <!-- 1. Relações entre duas personalidades -->
    <center>
      <h4><p>Relações entre duas personalidades</p></h4>
      <form class="container-fluid justify-content-center align-items-center">
      <input id="autocomplete_per_one-value" type="hidden" name="wiki">
      <input id="autocomplete_per_two-value" type="hidden" name="wiki">
      <div class="control-group">
          <div class="controls controls-row row-fluid col-xs-4">
              <input id="autocomplete_per_one" class="span10" type="text" placeholder="Personalidade" />
              <input id="autocomplete_per_two" class="span10" type="text" placeholder="Personalidade" />
              <button type="button" id='btn_two' class="btn btn-primary btn-sm">Procurar</button>
          </div>
      </div>
      </form>
    </center>

    <br><hr>

    <!-- 2. Relações entre (membros de) um partido e uma personalidade -->
    <center>
      <h4><p>Relações de membros de um partido e uma personalidade</p></h4>
      <h6>e.g.: 'Que personalidades do BE se oposeram a Jerónimo de Sousa?'</h6>
      <h6>e.g.: 'Quem de dentro do PS se opôs a José Sócrates?'</h6>
      <br>
      <form class="container-fluid justify-content-center align-items-center">
        <input id="autocomplete_three_partido_value" type="hidden" name="wiki">
        <input id="autocomplete_three_pessoa_value" type="hidden" name="wiki">
        <div class="control-group">
            <div class="controls controls-row row-fluid col-xs-4">
                <input id="autocomplete_three_partido" class="span10" type="text" placeholder="Partido" />
                  <div class="dropdown" style="display: inline;">
                    <button class="btn btn-secondary dropdown-toggle" type="button"
                            id="dropdownMenuButton2" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">opoe-se</button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
                        <a class="dropdown-item">opoe-se</a>
                        <a class="dropdown-item">apoia</a>
                    </div>
                  </div>
                <input id="autocomplete_three_pessoa" class="span10" type="text" placeholder="Personalidade" />
                <button type="button" id='btn_three' class="btn btn-primary btn-sm">Procurar</button>
              </div>
        </div>
      </form>
    </center>

    <br><hr>

    <!-- 3. Relações entre uma personalidade e (membros de) um partido -->
    <center>
      <h4><p>Relações de uma personalidade e membros de um partido</p></h4>
      <h6>e.g.: 'António Costa esteve de acordo/apoiou quem do PCP?'</h6>
      <h6>e.g.: 'André Ventura opos-se a quem do CDS/PP?'</h6>
      <br>
      <form class="container-fluid justify-content-center align-items-center">
        <input id="autocomplete_four_partido_value" type="hidden" name="wiki">
        <input id="autocomplete_four_pessoa_value" type="hidden" name="wiki">
        <div class="control-group">
            <div class="controls controls-row row-fluid col-xs-4">
                <input id="autocomplete_four_pessoa" class="span10" type="text" placeholder="Personalidade" />
                <div class="dropdown" style="display: inline;">
                    <button class="btn btn-secondary dropdown-toggle" type="button"
                            id="dropdownMenuButton3" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">opoe-se</button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton3">
                        <a class="dropdown-item">opoe-se</a>
                        <a class="dropdown-item">apoia</a>
                    </div>
                </div>
                <input id="autocomplete_four_partido" class="span10" type="text" placeholder="Partido"/>
                <button type="button" id='btn_four' class="btn btn-primary btn-sm">Procurar</button>
            </div>
        </div>
      </form>
    <center>

    <br><hr>

    <!-- 4. Relações entre (membros de) um partido e (membros de) um outro partido -->
    <center>
      <h4><p>Relações entre membros de dois partidos</p></h4>
      <h6>e.g.: 'Que personalidades do BE se oposeram a personalidades do PCP?</h6>
      <h6>e.g.: 'Que personalidades do PS apoiaram personalidades do PSD?'</h6>
      <br>
      <form class="container-fluid justify-content-center align-items-center">
        <input id="autocomplete_five_party_one_value" type="hidden" name="wiki">
        <input id="autocomplete_five_party_two_value" type="hidden" name="wiki">

        <div class="control-group">
            <div class="controls controls-row row-fluid col-xs-4">
                <input id="autocomplete_five_party_one" class="span10" type="text" placeholder="Partido" />
                  <div class="dropdown" style="display: inline;">
                    <button class="btn btn-secondary dropdown-toggle" type="button"
                            id="dropdownMenuButton4" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">opoe-se</button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton4">
                        <a class="dropdown-item">opoe-se</a>
                        <a class="dropdown-item">apoia</a>
                  </div>
              </div>
                <input id="autocomplete_five_party_two" class="span10" type="text" placeholder="Partido" />
                <button type="button" id='btn_five' class="btn btn-primary btn-sm">Procurar</button>
              </div>
        </div>
      </form>
    </center>

    <div id="entityResults" class="w-85 p-2" align="left"></div>

    </div>

  </div>

<br><br>

{% endblock %}
