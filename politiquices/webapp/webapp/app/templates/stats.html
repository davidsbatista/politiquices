{% extends 'base.html' %}

{% block title %} Estatísticas {% endblock %}

{% block body %}

<div class="container" id="container">

    <div id="inner" class="w-100 p-1">

    <br>

    <center><h3><b>Análises Estátisticas</b></h3></center>

    <br>

    <center>
    <h4>
        <a href="/entities">{{items.nr_persons}} personalidades</a> e <a href="/parties">{{items.nr_parties}} partidos políticos</a>
    </h4>
    </center>

    <br>

    <div class="container h-100">
        <h4><b><center>{{items.nr_articles}} títulos de notícias</center></b></h4>
        <div class="row h-100 justify-content-center align-items-center">            
            <br><br>
            <canvas id="myChart" width="1000" height="250"></canvas>
        </div>
    </div>

    <br><br>

    <div class="container h-100">
        <h4><b><center>Artigos por Ano por Tipo de Relação</center></b></h4>
        <div class="row h-100 justify-content-center align-items-center">
            <br><br>
            <canvas id="myChart2" width="1000" height="250"></canvas>
        </div>
    </div>

    <br><br>

    <div class="container h-100">
        <h4><b><center>Nº Relações/Artigos por Personalidade</center></b></h4>        
        <div class="row h-100 justify-content-center align-items-center">            
            <br><br>
            <canvas id="barChart_per_freq" width="100" height="250"></canvas>
        </div>
    </div>


    <br><br>

    <div class="container h-100">
        <h4><b><center>Personalidades com mais co-ocorrências</center></b></h4>
        <div class="row h-100 justify-content-center align-items-center">            
            <br><br>
            <canvas id="barChart_co_occurr" width="100" height="250"></canvas>
        </div>
    </div>

    <!---
    // https://codepen.io/jamiecalder/pen/NrROeB
    // https://apexcharts.com/javascript-chart-demos/bar-charts/stacked/
    <div class="container h-100">
        <h4><b><center>Tipos de relações por cada personalidade</center></b></h4>
        <div class="row h-100 justify-content-center align-items-center">
            <br><br>
            <canvas id="Chart1" width="100" height="25"></canvas>
        </div>
    </div>
    -->

    <script>
        // Articles
        var ctx = document.getElementById('myChart');
        var color = Chart.helpers.color;
        var year_labels = {{ items['nr_articles_year_labels']|tojson }};
        var year_articles = {{ items['nr_articles_year_values']|tojson }};

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {labels: year_labels,
                datasets: [{
                        label: 'No. of articles',
                        backgroundColor: "#4d6072",
                        data: year_articles
                        }]
                }
        });

        // Articles rel-type, year
        var ctx = document.getElementById('myChart2');
        var color = Chart.helpers.color;
        var year_labels = {{ items['nr_articles_year_labels']|tojson }};
        var ent1_opposes_ent2 = {{ items['ent1_opposes_ent2']|tojson }};
        var ent2_opposes_ent1 = {{ items['ent2_opposes_ent1']|tojson }};
        var ent1_supports_ent2 = {{ items['ent1_supports_ent2']|tojson }};
        var ent2_supports_ent1 = {{ items['ent2_supports_ent1']|tojson }};
        var ent1_other_ent2 = {{ items['ent1_other_ent2']|tojson }};
        var ent2_other_ent1 = {{ items['ent2_other_ent1']|tojson }};

        console.log(ent1_opposes_ent2)

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: year_labels,
                datasets: [
                {
                    label: 'ent1_opposes_ent2',
                    backgroundColor: "#caf270",
                    data: ent1_opposes_ent2
                }, 
                {
                    label: 'ent2_opposes_ent1',
                    backgroundColor: "#45c490",
                    data: ent2_opposes_ent1,
                }, 
                {
                    label: 'ent1_supports_ent2',
                    backgroundColor: "#008d93",
                    data: ent1_supports_ent2,
                }, 
                {
                    label: 'ent2_supports_ent1',
                    backgroundColor: "#2e5468",
                    data: ent2_supports_ent1,
                },
                {
                    label: 'ent1_other_ent2',
                    backgroundColor: "#ff5468",
                    data: ent1_other_ent2,
                },
                {
                    label: 'ent2_other_ent1',
                    backgroundColor: "#2e54ff",
                    data: ent2_other_ent1,
                },
                ],
            },
            options: {
                tooltips: {
                    displayColors: true,
                    callbacks:{
                        mode: 'x',
                    },
                },
                scales: {
                    xAxes: [{
                        stacked: true,
                        gridLines: {
                            display: false,
                        }
                    }],
                    yAxes: [{
                        stacked: true,
                        ticks: {
                            beginAtZero: true,
                        },
                        type: 'linear',
                    }]
                },
                responsive: true,
                maintainAspectRatio: false,
                legend: { position: 'bottom' },
            }
        });

        // Person Freq.
        var ctx = document.getElementById('barChart_per_freq');
        var per_freq_labels = {{ items['per_freq_labels']|tojson }};
        var per_freq_values = {{ items['per_freq_values']|tojson }};

        var myBarChart = new Chart(ctx, {
            type: 'horizontalBar',
            data: {labels: per_freq_labels,
                datasets: [{
                        label: 'No. of articles',
                        backgroundColor: "#4d6072",
                        data: per_freq_values
                        }]
                }
        });
        
        // Person Co-Occur. Freq.
        var ctx = document.getElementById('barChart_co_occurr');
        var per_co_occ_labels = {{ items['per_co_occurrence_labels']|tojson }};
        var per_co_occ_values = {{ items['per_co_occurrence_values']|tojson }};

        var myBarChart = new Chart(ctx, {
                type: 'horizontalBar',
                data: {labels: per_co_occ_labels,
                    datasets: [{
                            label: 'No. of articles',
                            backgroundColor: "#4d6072",
                            data: per_co_occ_values
                            }]
                    }
        });
    
    </script>

    </div>

    <br><br>

</div>

{% endblock %}
