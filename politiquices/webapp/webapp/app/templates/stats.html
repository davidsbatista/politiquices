{% extends 'base.html' %}

{% block title %} Estatísticas {% endblock %}

{% block body %}

<div class="container" id="container">

    <div id="inner" class="w-100 p-1">

    <br><br>

    <div class="container d-flex align-items-center justify-content-center">
        <div class="w-75 p-2" align="center">
            <center>
                <h4><a href="/entities"><b>{{items.nr_persons}} personalidades políticas</b></a></h4>
            </center>
            <br><br>
            <center>
                <h4><a href="/parties"><b>XX partidos políticos</b></a></h4>
            </center>
         </div>
    </div>

    <br>

    <div class="container h-100">
        <div class="row h-100 justify-content-center align-items-center">
            <h4><b>{{items.nr_articles}}</b> títulos de artigos analisados</h4>
            <br><br>
            <canvas id="myChart" width="1000" height="250"></canvas>
        </div>
    </div>

    <br><br>

    <div class="container h-100">
        <div class="row h-100 justify-content-center align-items-center">
            <h4><b>Title</b></h4>
            <br><br>
            <canvas id="barChart" width="100" height="250"></canvas>
        </div>
    </div>


    <script>
        // Articles
        var ctx = document.getElementById('myChart');
        var color = Chart.helpers.color;

        var year_labels = {{ items['year_labels']|tojson }};
        var year_articles = {{ items['year_articles']|tojson }};

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {labels: year_labels,
                   datasets: [{
                        label: 'No. of articles',
                        backgroundColor: "#4d6072",
                        data: year_articles
                        }]
                   }
            });



        // Person
        var ctx = document.getElementById('barChart');
        var per_labels = {{ per_freq_labels|tojson }};
        var per_values = {{ per_freq_values|tojson }};

        var myBarChart = new Chart(ctx, {
            type: 'horizontalBar',
            data: {labels: per_labels,
                   datasets: [{
                        label: 'No. of articles',
                        backgroundColor: "#4d6072",
                        data: per_values
                        }]
                   },
             options: {
               events: ["mousemove", "mouseout", "click", "touchstart", "touchmove", "touchend"],
               onClick: function(e, data) {
                   console.log('mouse')
                   var ctx = $("#barChart")[0].getContext("2d");
                   var base = that.chart.chartArea.bottom;
                   var height = that.chart.chart.height;
                   var width = that.chart.chart.scales['x-axis-0'].width;
                   var offset = $('#chart').offset().top - $(window).scrollTop();
                   if(e.pageY > base + offset){
                       var count = that.chart.scales['x-axis-0'].ticks.length;
                       var padding_left = that.chart.scales['x-axis-0'].paddingLeft;
                       var padding_right = that.chart.scales['x-axis-0'].paddingRight;
                       var xwidth = (width-padding_left-padding_right)/count;
                       // don't call for padding areas
                       var bar_index = (e.offsetX - padding_left - that.chart.scales['y-axis-0'].width) / xwidth;
                       if(bar_index > 0 & bar_index < count){
                           bar_index = Math.floor(bar_index);
                           console.log(bar_index);
                       }
                   }
               }
           }
        });


    </script>

    </div>

</div>

{% endblock %}
