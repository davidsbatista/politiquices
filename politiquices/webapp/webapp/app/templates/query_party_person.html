
<br>

<div class="container">

    <!-- Info about the two entities -->
    <div class="row justify-content-center">

        <div class="col-xs-6">
            <div id="outer_party" class="container d-flex align-items-center justify-content-center">
                <div class="media">
                    <figure class="figure">
                        <a href=/party_members?q={{party.wiki_id}} target="_blank">
                            <img class="figure-img img-fluid rounded" src="{{party.party_logo}}" width="120" height="150" alt="">
                            <figcaption class="figure-caption" style="text-align:center;">
                                <b>{{party.party_label}}</b>
                            </figcaption>
                        </a>
                    </figure>
                </div>
            </div>
        </div>

        <div class="col-xs-6">
            <center><h4><b>{{relationship_text}}</b></h4></center>
        </div>

        <div class="col-xs-6">
            <div id="outer_person" class="container d-flex align-items-center justify-content-center">

            <!-- Foto -->
            <div class="media">
                <figure class="figure">
                    <a href=/entity?q={{person.wiki_id}} target="_blank">
                        <img src={{person.image_url}} class="figure-img img-fluid rounded" width="144" height="180" alt="{{person.name}}" title="{{person.name}}">
                        <figcaption class="figure-caption" style="text-align:center;">
                            <b>{{person.name}}</b>
                        </figcaption>
                    </a>
                </figure>
            </div>

            <!-- Partidos -->
            <div class="col-auto">
                <table>
                  <tbody>
                  {% for item in person.parties %}
                  <tr>
                      <td>
                        <a href="/party_members?q={{item.wiki_id}}" target="_blank">
                            <img src={{item.image_url}} class="figure-img img-fluid rounded" width="60" height="75" alt="{{item.name}}" title="{{item.name}}">
                        </a>
                      </td>
                  </tr>
                  {% endfor %}
                  </tbody>
                </table>
                </div>
            </div>

        </div>


    </div>
    <br><br>

    <!-- Char with relationships throughout the years -->
    <center><h4><b>Frequência das relações ao longo dos anos</b></h4></center>
    <br>
    <div class="container h-100">
      <div class="row h-100 justify-content-center align-items-center">
        <canvas id="myChart" width="900" height="250"></canvas>
      </div>
    </div>
    <script>
        var ctx = document.getElementById('myChart');
        var color = Chart.helpers.color;

        var year_labels = {{ labels|tojson }};
        var rel_freq = {{ rel_freq_year|tojson }};
        var rel_text = {{ rel_text|tojson }};

        // labels based on personalities names
        var ent1 = {{ party.party_label|tojson }};
        var ent2 = {{ person.name|tojson }};
        var label = `${ent1} ${rel_text} ${ent2}`

        if (rel_text == 'apoia') {
            var color = "#44861E";
        }

        if (rel_text == 'opõe-se') {
            var color = "#FF0000";
        }

        var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: year_labels,
          datasets: [
            {label: label, backgroundColor: "#FF0000", fill: true, data: rel_freq},
            ]
          },
        options: {
          scales: {
            x: {stacked: true},
          }
        }
    });
    </script>
    <br><br>

    <!--
    <script src="https://cdn.jsdelivr.net/npm/chart.js@next"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@next"></script>
    <div id="canvas-holder">
        <canvas id="chart-area" width="400" height="100"></canvas>
    </div>
    <script>
        var ctx = document.getElementById("chart-area").getContext("2d");
			window.myMatrix = new Chart(ctx, {
				type: 'matrix',
				data: {
					datasets: [{
						label: 'My Matrix',
						data: [
							{x: 'A', y: 'X', v: 11},
							{x: 'A', y: 'Y', v: 12},
							{x: 'A', y: 'Z', v: 13},
							{x: 'B', y: 'X', v: 21},
							{x: 'B', y: 'Y', v: 22},
							{x: 'B', y: 'Z', v: 23},
							{x: 'C', y: 'X', v: 31},
							{x: 'C', y: 'Y', v: 32},
							{x: 'C', y: 'Z', v: 33}
						],
						backgroundColor(context) {
							const value = context.dataset.data[context.dataIndex].v;
							const alpha = (value - 5) / 40;
							return Chart.helpers.color('green').alpha(alpha).rgbString();
						},
						width(context) {
							const a = context.chart.chartArea;
							if (!a) {
								return 0;
							}
							return (a.right - a.left) / 3 - 2;
						},
						height(context) {
							const a = context.chart.chartArea;
							if (!a) {
								return 0;
							}
							return (a.bottom - a.top) / 3 - 2;
						}
					}]
				},
				options: {
					legend: {
						display: false
					},
					tooltips: {
						callbacks: {
							title() {
								return '';
							},
							label(context) {
								const v = context.dataset.data[context.dataIndex];
								return ['x: ' + v.x, 'y: ' + v.y, 'v: ' + v.v];
							}
						}
					},
					scales: {
						x: {
							type: 'category',
							labels: ['A', 'B', 'C'],
							ticks: {
								display: true
							},
							gridLines: {
								display: false
							}
						},
						y: {
							type: 'category',
							labels: ['X', 'Y', 'Z'],
							offset: true,
              reverse: false,
							ticks: {
								display: true
							},
							gridLines: {
								display: false
							}
						}
					}
				}
			});



    </script>
    -->

    <!--
    <script src="static/vendor/Chart.HeatMap.js"></script>
    <canvas id="heatmap" width="800" height="400"></canvas>
    -->

    <script src="static/vendor/apexcharts.js"></script>
    <div id="chart"></div>

    <script>

        var heatmap = {{ heatmap|tojson }};
        console.log(heatmap)


        var options = {
          series: heatmap,
          /*
          series: [
            {name: 'João', data: [0,1,3,4,5]},
            {name: 'Metric2', data: [0,1,3,4,5]},
            {
              name: 'Metric3',
              data: [0,1,3,4,5]
            },
            {
              name: 'Metric4',
              data: [0,1,3,4,5]
            },
            {
              name: 'Metric5',
              data: [0,1,3,4,5]
            },
            {
              name: 'Metric6',
              data: [0,1,3,4,5]
            },
            {
              name: 'Metric7',
              data: [0,1,3,4,5]
            },
            {
              name: 'Metric8',
              data: [0,1,3,4,5]
            },
        ],
        */
          chart: {
          height: 350,
          type: 'heatmap',
        },
        plotOptions: {
          heatmap: {
            radius: 0,
            enableShades: false,
            colorScale: {
              ranges: [{
                  from: 0,
                  to: 50,
                  color: '#008FFB'
                },
                {
                  from: 51,
                  to: 100,
                  color: '#00E396'
                },
              ],
            },

          }
        },
        dataLabels: {
          enabled: true,
          style: {
            colors: ['#fff']
          }
        },
        xaxis: {
          type: 'category',
        },
        title: {
          text: ''
        },
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
    </script>


    <!-- List of relationships -->
    <center id="relationships"><h4><b>Relações expressas em títulos de notícias</b></h4></center>
    <br><br>
    <div class="container" id="single_table">
        <table id="table">
            <thead>
                <tr>
                    <th data-sortable="true" data-field="data">Data</th>
                    <th data-field="titulo">Título</th>
                    <th data-field="ent1" data-force-export="true" data-visible="false">Personalidade_1</th>
                    <th data-field="ent2" data-force-export="true" data-visible="false">Personalidade_2</th>
                    <th data-field="ent1_wiki" data-force-export="true" data-visible="false">Wikidata_PER_1</th>
                    <th data-field="ent2_wiki" data-force-export="true" data-visible="false">Wikidata_PER_2</th>
                    <th data-align="center" data-force-hide="true" data-field="link">Artigo</th>
                    <th data-field="url" data-force-export="true" data-visible="false">URL</th>
                </tr>
            </thead>
        </table>
    </div>

</div>

<!-- Datatables: for some reason this needs to reloaded to trigger the rendering of the table -->
<script src="https://unpkg.com/bootstrap-table@1.18.2/dist/bootstrap-table.min.js"></script>

<script>
    var relationships = {{ relationships|safe }};
    var $table = $('#table');
    $(function (table) {
        $('#table').bootstrapTable({
            data: relationships,
            //toolbar: "#toolbar",
            //pagination: true,
            //sidePagination: "server",
            //pageSize: "10",
            //pageList: "[10, 25, 50, All]",
            search: true,
            height: "600",
            showExport: true,
            exportTypes: ['csv'],
            exportDataType: 'all',
            showFooter: false,
            exportFooter: false
        });
    });
    $(document).scrollTop( $(relationships).offset().top);
    $('html,body').scrollTop(0);

</script>
